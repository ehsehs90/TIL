from django.shortcuts import render, redirect
from .models import Movie, Rating
from .forms import MovieForm
# Create your views here.
def new(request):
    return render(request, 'movies/form.html')


def index(request):
    movies= Movie.objects.all()[::-1]
    context={'movies':movies} 
    return render(request,'movies/index.html', context)

def create(request):
    if request.method =='POST':
        # Binding 과정
        # 폼 인스턴스를 생성하고, 전달받은 데이터를 채운다
        # 인스턴스에 데이터를 채워서 , 유효성 검증을 진행한다
        form = MovieForm(request.POST, request.FILES)
        print('?')
        if form.is_valid(): #form이 유효성 검증을 마치면 dic 형태로 바뀐다
            print('?!!!!!!!??')
            movie = form.save(commit=False)            
            print('???')
            movie.user = request.user
            print('???????')
            movie.save()
            return redirect('movies:detail' , movie.pk)    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    else:
        form = MovieForm()
    context = {'form': form}
    return render(request, 'movies/form.html', context)
    


## 동적바인딩
def detail(request, movie_pk):
    movie = Movie.objects.get(pk=movie_pk)
    context = {'movie' : movie,
               }    
    return render(request, 'movies/detail.html', context)

def ratings_new(request, movie_pk):
    movie = Movie.objects.get(pk=movie_pk)
    context = { 'movie':movie,}

    return render(request, 'movies/ratings_new.html',context)

# def edit(request, movie_pk):
#     movie = Movie.objects.get(pk=movie_pk)
#     context ={'movie':movie}
    
#     return render(request, 'movies/edit.html',context)

# def update(reqeust, movie_pk):

#     movie = Movie.objects.get(pk=movie_pk)

#     movie.title = reqeust.POST.get('title')
#     movie.title_en = reqeust.POST.get('title_en')
#     movie.audience = reqeust.POST.get('audience')
#     movie.open_date = reqeust.POST.get('open_date')
#     movie.genre = reqeust.POST.get('genre')
#     movie.watch_grade = reqeust.POST.get('watch_grade')
#     movie.score = reqeust.POST.get('score')
#     movie.poster_url = reqeust.POST.get('poster_url')
#     movie.description = reqeust.POST.get('description')
#     # movie.movie = Movie(title=title,title_en=title_en,audience=audience,
#     # open_date=open_date, genre=genre,score=score,poster_url=poster_url,description=description)
    
#     movie.save()
#     return redirect(f'/movies/{movie.pk}/')

# def delete(request, movie_pk):

#     movie = Movie.objects.get(pk=movie_pk)
#     movie.delete()
    

#     return redirect('/movies/index/')